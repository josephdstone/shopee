<!DOCTYPE html>

<html>

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="jquery-mobile/styles/jquery.mobile-1.3.1.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />

        <script src="cordova.js" type="text/javascript"></script>
        <script src="jquery-mobile/js/jquery-1.9.1.min.js" type="text/javascript"></script>
        <script src="jquery-mobile/js/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>

        <script src="scripts/login.js" type="text/javascript"></script>
        <script src="scripts/location.js" type="text/javascript"></script>
        <script src="Plugins/com.phonegap.plugins.barcodescanner-0.7.0/www/barcodescanner.js"></script>
        <title></title>
    </head>

    <body>
        <H1 style="color:#B80000">Shoppee List</H1>
        <H4 style="color:#B80000">Scan Your Items</H4>
        <img style="width: 110px; height: 100px" src="styles/images/cart.ico">
        
        <br>
        <br>
        <a style="margin-right:5%;margin-left:5%;" data-role="button" data-icon="plus" data-iconpos="right" id="btnScan" data-theme="b">Scan Product</a>
        <a style="margin-right:5%;margin-left:5%;" id="btnBack" data-role="button" href="modeSelect.html"
           data-icon="back" data-iconpos="right" data-transition="slide" data-theme="b">
            Previous Page
        </a>
        <a style="margin-right:5%;margin-left:5%;" id="btnClearTotal" data-role="button" onClick="clearShoppeeList()" href=""
           data-icon="delete" data-iconpos="right" data-theme="b">
            Clear Shopping List
        </a>
        <br>
        <div style="margin-right:5%;margin-left:5%;" data-role="collapsible" data-theme="b" data-content-theme="b">
           <h3>Manual Options</h3>
            <p>
                    
        <label>Grocery Item</label>
            <input style="text-align:center" id="groceryItem" value="" data-mini="false" type="text">
            <br>
        <a style="margin-right:5%;margin-left:5%;" id="btnAddGrocery" data-role="button" onClick="manualAdd()"
           data-icon="plus" data-iconpos="right" data-theme="b">
            Add Item
        </a>
                    </p>
            </div>
        
    <ul style="margin-left:-25px; padding-right:25px; width:90%" data-theme="b" data-role="collapsible">
	<h3 style="text-align:center;" data-theme="b">Recipe Search</h3>
	<p>
            <input style="text-align:center" id="recipeSearch" placeholder="Enter Dish" data-mini="false" type="text">
            <br>
        <a style="margin-right:5%;margin-left:5%;" id="btnAddGrocery" data-role="button" onClick="ajaxRecipeSearch()"
           data-icon="search" data-iconpos="right" data-theme="b">
            Search Recipes
        </a>
        <ul style="margin-left:-52px; width:110%" data-theme="b" data-role="collapsible">
	<h3 style="text-align:center;" data-theme="b">Recipe Results</h3>
	<p>
        <ul style="width:110%"data-role="listview">
            <ui id="recipeList" data-role="listview" data-inset="true" data-theme="b"></ui> 
            <li data-inset="true" data-role="listview" data-theme="a" id="ingredientList"></li>
    </ul>
    </p>
	</ul>
    </p>
	</ul>    
	        
        <br>
        <h3>Shoppee List</h3>
        <ul data-role="listview">
            <li id="results" data-role="listview" data-theme="b"></li>
	    </ul>
        
        <style>
        ul
            {
    			width: 100%;
    			margin-left: -40px;
			}
            
        .custom-li
            {
                padding: 0;
                border-width:0;
            }

        .custom-bottom-li 
            {
                border-top-width: 0;  
}

        .custom-collapsible
            {
                margin: 0;   
                border-bottom-right-radius: 0;
                border-bottom-left-radius: 0;
                border-width:0;
            }
        </style>
        <script>
            var totalScanned = -0;
            var taxRate = -0;
            var grandTotal = -0;
            var counter = -0;
            var reccounter = -0;
            var ingcounter= -0;
            var subtract = -0;
            window.onload = populateList();
            function populateList()
            {
              strcounter = localStorage.getItem('counter');
              
                if (strcounter != null)
                    {
                        counter = parseInt(strcounter);
                        for (var i = 0; i < counter; i++) 
                            {
                               var grocItem = "" 
                                grocItem = localStorage.getItem(i);
                                alert(grocItem);
                                $("#results").append("<li data-icon='minus' id="+i+" onclick='deleteItem("+i+")', "+i+");'><a style='color:white' id='a"+i+"'>"+grocItem+"</a></li>");
                                //$('#results').listview('refresh');
                            }
                    }
                //localStorage["counter"] += 1;
                
                //localStorage["ingredient"+localStorage["counter"]] = name;
            }
            
            function ajaxRecipeSearch()
            {
             $.ajax({
                                'async':false,
                                'type': "GET",
                                'url': "http://api.yummly.com/v1/api/recipes?_app_id=8fbb7e89&_app_key=f1d5e9fc297940a7033af5b98382c75d&q="+$("#recipeSearch").val(),
                                'datatype':"json",
  				              'success': function(data) 
                                    {

                                        if (data != "")
                                        {
                                        //alert(data.matches[0].recipeName);
                                            //alert(data.matches.length);
                                            for (var i = 0; i < data.matches.length; i++) 
                                                {   
                                                    reccounter += 1;
                                                   $("#recipeList").append("<li data-role='listview' data-icon='plus' id="+reccounter+" onclick='deleteListItem(rli"+reccounter+")', "+reccounter+");'><a id='rlist"+reccounter+"'>"+data.matches[i].recipeName+"</a></li>");
                                                    
                                                   $('#recipeList').listview('refresh');
                                                    for (var j = 0; j < data.matches[i].ingredients.length; j++)
                                                    {
                                                        var ingredient = data.matches[i].ingredients[j];
                                                        //alert(ingredient);
                                                        strcounter = localStorage.getItem('counter');
                                                        if (strcounter!="")
                                                            {
                                                                counter = parseInt(strcounter);
                                                            }
                                                        counter += 1;
                                                        localStorage.setItem('ingredient'+localStorage.getItem('counter'), name)
                                                        $("#ingredientList").append("<li data-role='listview' data-icon='plus' id='in'"+ingcounter+" onclick='addIngredient("+ingredient+")', "+ingcounter+");'><a id='ilist"+ingcounter+"'>"+ingredient+"</a></li>");
                                                        $("#ingredientList").listview('refresh');
                                                    }
                                                    //localStorage["recipe"+reccounter] = data.matches[i].recipeName;
                                                    //alert(localStorage["recipe"+reccounter]);
                                                }                                            
                                        }
                                        
                                     
                                    },
                                'error':function(data)
                                    {
                                        alert("Oops, sorry about that! Something happened, please try again!.");
                        
                                    }
                                })                               
            }
                                        
            function clearShoppeeList()
            {
                $("#results").html("").add();
            	counter = 0;
                localStorage.setItem('countcounterunter);
                                    
            }
                     
            function addIngredient(name)
            {
                strcounter = localStorage.getItem('counter');
                if (strcounter != "")
                   {
                       counter = parseInt(strcounter);                                 
                   }                       
                counter += 1;
                localStorage.setItem('counter', counter);
                localStorage.setItem("ing"+counter, name);
                $("#results").append("<li data-icon='minus' id="+counter+" onclick='deleteItem("+counter+")', "+counter+");'><a style='color:white' id='a"+counter+"'>"+name+"</a></li>");                         
                $('#results').listview('refresh'); 
            }
                                        
            function deleteItem(id)
            {
                
                $("#" + id).remove();
                localStorage.removeItem('ingredient'+id);
                
            }
            function manualAdd()
            {
            if ($("#groceryItem").val() != "")
               {                                        
                  var strcounter = localStorage.getItem('counter');                                     
                  
                                                    
               if (strcounter != "")
                {                                                                      
                  counter = parseInt(strcounter);
                }        
                counter += 1;                                    
                //parseInt(counter) += 1;                                    
                localStorage.setItem('ingredient'+counter, $("#groceryItem").val());                                   
                localStorage.setItem('counter', counter);                                    
                var grocery = $("#groceryItem").val().replace(/[^a-zA-Z0-9]/g,' ');
                $("#results").append("<li data-icon='minus' id="+counter+" onclick='deleteItem("+counter+")', "+counter+");'><a style='color:white' id='a"+counter+"'>"+grocery+"</a></li>");
                $('#results').listview('refresh');
                $("#groceryItem").val("");                                    
                
                }
                   else 
                   alert("Please enter an item.");
            }
            
            $("#btnScan").click(function () 
                {          
                window.plugins.barcodeScanner.scan
                (
                    function(result) 
                    {	
                        if (!result.cancelled) 
                        {
                            $.ajax
                            ({
                                'async':false,
                                'type': "GET",
                                'url': "https://api.nutritionix.com/v1_1/item?upc="+result.text+"&appId=6dd9a013&appKey=2f130ac4bb1d8caac032e7a0e426ead9",
                                'datatype':"json",
  				              'success': function(data) 
                                    {
                                        if (data != "")
                                        {
                                        var itemName = data.item_name.replace(/[^a-zA-Z0-9]/g,' ');
                                        
                                        strcounter = localStorage.getItem('counter');
                                        if (strcounter != "")
                                              {
                                                  counter = parseInt(strcounter);      
                                              }
                                        counter += 1;
                                        localStorage.setItem('counter', counter);
                                        localStorage.setItem('ingredient'+counter, itemName);
                                        $("#results").append("<li data-icon='minus' id="+counter+" onclick='deleteItem("+counter+")', "+counter+");'><a style='color:white' id='a"+counter+"'>"+itemName+"</a></li>");
                                        $('#results').listview('refresh'); 
                                            
                                        }
                                        else
                                        alert("Item not found, please use Manual Options to add to your Shoppee List.");
                                
                                        
                                    }
                                
                                
                                
                                
                 })
                        }
                    })
            });
            
            
            
                   
        </script>
    
    </body>
</html>